<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Generadores Luhn y Damm</title>
  <style>
    .generator-container {
      display: flex;
      gap: 40px;
      padding: 20px;
      flex-wrap: wrap;
    }
    .generator {
      border: 1px solid #ccc;
      padding: 20px;
      width: 300px;
      background: #f9f9f9;
      border-radius: 8px;
    }
    .generator label {
      display: block;
      margin-top: 10px;
    }
    .generator input,
    .generator select {
      width: 100%;
      padding: 5px;
    }
    .generator button {
      margin-top: 10px;
      padding: 8px;
      width: 100%;
    }
    .generator pre {
      margin-top: 10px;
      background: #eee;
      padding: 10px;
      height: 120px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="generator-container">
    <div class="generator">
      <h2>Generador Luhn</h2>
      <input id="luhnBase" type="text" placeholder="Ej: 453987010293xxxx" maxlength="16">
      <input id="luhnMonth" type="text" placeholder="Mes (01-12)" maxlength="2">
      <input id="luhnYear" type="text" placeholder="Año (2025-2031)" maxlength="4">
      <input id="luhnCVV" type="text" placeholder="CVV (opcional)" maxlength="3">
      <input id="luhnCount" type="number" placeholder="Cantidad" min="1" value="1">
      <button onclick="generateLuhn()">Generar</button>
      <pre id="luhnResult"></pre>
    </div>

    <div class="generator">
      <h2>Generador Damm</h2>
      <input id="dammBase" type="text" placeholder="Ej: 453987010293xxxx" maxlength="16">
      <input id="dammMonth" type="text" placeholder="Mes (01-12)" maxlength="2">
      <input id="dammYear" type="text" placeholder="Año (2025-2031)" maxlength="4">
      <input id="dammCVV" type="text" placeholder="CVV (opcional)" maxlength="3">
      <input id="dammCount" type="number" placeholder="Cantidad" min="1" value="1">
      <button onclick="generateDamm()">Generar</button>
      <pre id="dammResult"></pre>
    </div>
  </div>

  <script>
    function generateLuhn() {
      const base = document.getElementById('luhnBase').value.trim();
      const month = document.getElementById('luhnMonth').value.trim();
      const year = document.getElementById('luhnYear').value.trim();
      const cvvInput = document.getElementById('luhnCVV').value.trim();
      const count = parseInt(document.getElementById('luhnCount').value);
      const output = document.getElementById('luhnResult');

      if (!base.includes('x')) return alert("Incluye 'x' en el número base");

      let results = [];
      let generated = new Set();

      while (results.length < count) {
        let current = '';
        for (let c of base) {
          current += c === 'x' ? Math.floor(Math.random() * 10) : c;
        }
        if (luhnCheck(current) && !generated.has(current)) {
          const cvv = cvvInput || String(Math.floor(Math.random() * 900) + 100);
          results.push(`${current}|${month}|${year}|${cvv}`);
          generated.add(current);
        }
      }
      output.textContent = results.join('\n');
    }

    function luhnCheck(number) {
      let sum = 0;
      let shouldDouble = false;
      for (let i = number.length - 1; i >= 0; i--) {
        let digit = parseInt(number[i]);
        if (shouldDouble) {
          digit *= 2;
          if (digit > 9) digit -= 9;
        }
        sum += digit;
        shouldDouble = !shouldDouble;
      }
      return sum % 10 === 0;
    }

    function generateDamm() {
      const base = document.getElementById('dammBase').value.trim();
      const month = document.getElementById('dammMonth').value.trim();
      const year = document.getElementById('dammYear').value.trim();
      const cvvInput = document.getElementById('dammCVV').value.trim();
      const count = parseInt(document.getElementById('dammCount').value);
      const output = document.getElementById('dammResult');

      if (!base.includes('x')) return alert("Incluye 'x' en el número base");

      let results = [];
      let generated = new Set();

      while (results.length < count) {
        let current = '';
        for (let c of base) {
          current += c === 'x' ? Math.floor(Math.random() * 10) : c;
        }
        if (dammCheck(current) && !generated.has(current)) {
          const cvv = cvvInput || String(Math.floor(Math.random() * 900) + 100);
          results.push(`${current}|${month}|${year}|${cvv}`);
          generated.add(current);
        }
      }
      output.textContent = results.join('\n');
    }

    function dammCheck(number) {
      const table = [
        [0,3,1,7,5,9,8,6,4,2],
        [7,0,9,2,1,5,4,8,6,3],
        [4,2,0,6,8,7,1,3,5,9],
        [1,7,5,0,9,8,3,4,2,6],
        [6,1,2,3,0,4,5,9,7,8],
        [3,6,7,4,2,0,9,5,8,1],
        [5,8,6,9,7,2,0,1,3,4],
        [8,9,4,5,3,6,2,0,1,7],
        [9,4,3,8,6,1,7,2,0,5],
        [2,5,8,1,4,3,6,7,9,0]
      ];
      let interim = 0;
      for (let digit of number) {
        interim = table[interim][parseInt(digit)];
      }
      return interim === 0;
    }
  </script>
</body>
</html>
