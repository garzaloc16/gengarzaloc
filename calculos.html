<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cálculo MercadoLibre</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f3f3f3; padding:20px; }
    .card { background:white; padding:20px; border-radius:16px; box-shadow:0 4px 10px rgba(0,0,0,0.1); margin:auto; }
    .max-w-md { max-width: 500px; }
    .max-w-2xl { max-width: 700px; }
    .w-full { width:100%; }
    .mb-4 { margin-bottom:1rem; }
    .mt-8 { margin-top:2rem; }
    .font-bold { font-weight:bold; }
    .font-semibold { font-weight:600; }
    .border { border:1px solid #ccc; }
    .p-2 { padding:0.5rem; }
    .p-4 { padding:1rem; }
    .rounded { border-radius:8px; }
    .bg-blue-600 { background:#2563eb; }
    .hover\:bg-blue-700:hover { background:#1d4ed8; }
    .text-white { color:white; }
    .text-center { text-align:center; }
    .text-2xl { font-size:1.5rem; }
    .text-xl { font-size:1.25rem; }
    button { cursor:pointer; font-size:1rem; }
    .result { white-space:pre-line; }
  </style>
</head>
<body>

  <!-- FORMULARIO 1 -->
  <div class="card max-w-md w-full">
    <h2 class="text-xl font-bold mb-4 text-center">Formulario de Compras</h2>

    <label class="font-semibold">Unidades compradas</label>
    <input id="unidades" type="number" class="w-full border p-2 rounded mb-4" value="1">

    <label class="font-semibold">Valor por unidad (COP)</label>
    <input id="valorUnidad" type="number" class="w-full border p-2 rounded mb-4" value="0">

    <label class="font-semibold">¿Pagaste envío?</label>
    <select id="pagoEnvio" class="w-full border p-2 rounded mb-4">
      <option>No</option>
      <option>Sí</option>
    </select>

    <label class="font-semibold">Valor del envío (COP)</label>
    <input id="valorEnvio" type="number" class="w-full border p-2 rounded mb-4" value="0">

    <label class="font-semibold">¿Pagaste impuestos?</label>
    <select id="pagoImpuestos" class="w-full border p-2 rounded mb-4">
      <option>No</option>
      <option>Sí</option>
    </select>

    <label class="font-semibold">Valor impuestos (COP)</label>
    <input id="valorImpuestos" type="number" class="w-full border p-2 rounded mb-4" value="0">

    <button onclick="calcularCostoFinal()" class="bg-blue-600 hover:bg-blue-700 text-white rounded p-2 w-full">
      Calcular costo por unidad
    </button>

    <div id="resultadoCompras" class="result mt-4 p-4 rounded bg-gray-100">
      Ingresa los datos y calcula.
    </div>
  </div>

  <!-- FORMULARIO 2 -->
  <div class="card max-w-2xl w-full mt-8">
    <h2 class="text-2xl font-bold mb-4 text-center">Cálculo de Ventas en MercadoLibre</h2>

    <label class="font-semibold">¿Usar costo calculado del formulario 1?</label>
    <select id="usarCosto" class="w-full border p-2 rounded mb-4">
      <option>Sí</option>
      <option>No</option>
    </select>

    <label class="font-semibold">Costo base manual (COP)</label>
    <input id="costoBaseManual" type="number" class="w-full border p-2 rounded mb-4" value="0">

    <label class="font-semibold">Categoría</label>
    <select id="categoria" class="w-full border p-2 rounded mb-4">
      <option>Celulares y Teléfonos</option>
      <option>Computación</option>
      <option>Consolas y Videojuegos</option>
      <option>Electrodomésticos</option>
      <option>Hogar y Muebles</option>
      <option>Accesorios para Vehículos</option>
      <option>Repuestos de Vehículos</option>
      <option>Herramientas</option>
      <option>Construcción</option>
      <option>Ropa, Zapatos y Accesorios</option>
      <option>Joyería y Relojes</option>
      <option>Belleza y Cuidado Personal</option>
      <option>Salud y Equipos Médicos</option>
      <option>Bebés</option>
      <option>Juguetes</option>
      <option>Deportes y Fitness</option>
      <option>Arte y Antigüedades</option>
      <option>Libros, Revistas y Comics</option>
      <option>Instrumentos Musicales</option>
      <option>Electrónica, Audio y Video</option>
      <option>Cámaras y Accesorios</option>
      <option>Inmuebles</option>
      <option>Servicios</option>
      <option>Otros</option>
    </select>

    <label class="font-semibold">Tipo de publicación</label>
    <select id="tipoPublicacion" class="w-full border p-2 rounded mb-4">
      <option value="premium">Premium</option>
      <option value="clasica">Clásica</option>
    </select>

    <label class="font-semibold">¿Ofrecer envío gratis?</label>
    <select id="envioGratis" class="w-full border p-2 rounded mb-4">
      <option>No</option>
      <option>Sí</option>
    </select>

    <label class="font-semibold">Peso del producto (kg)</label>
    <input id="peso" type="number" step="0.1" class="w-full border p-2 rounded mb-4" value="1">

    <hr class="my-4">

    <label class="font-semibold">¿Quieres poner tu precio de venta manual?</label>
    <input id="precioVentaManual" type="number" class="w-full border p-2 rounded mb-4" value="0">

    <button onclick="calcularVentas()" class="bg-blue-600 hover:bg-blue-700 text-white rounded p-2 w-full">
      Calcular
    </button>

    <div id="resultadoVentas" class="result mt-4 p-4 rounded bg-gray-100">
      Calcula el precio sugerido...
    </div>
  </div>

  <script>
    let costoFinalUnidad = 0;

    function formatoCOP(valor) {
      return valor.toLocaleString('es-CO', {style:'currency', currency:'COP', minimumFractionDigits:0});
    }

    function calcularCostoFinal() {
      const unidades = parseFloat(document.getElementById('unidades').value) || 1;
      const valorUnidad = parseFloat(document.getElementById('valorUnidad').value) || 0;
      const pagoEnvio = document.getElementById('pagoEnvio').value;
      const valorEnvio = parseFloat(document.getElementById('valorEnvio').value) || 0;
      const pagoImpuestos = document.getElementById('pagoImpuestos').value;
      const valorImpuestos = parseFloat(document.getElementById('valorImpuestos').value) || 0;

      let total = (valorUnidad * unidades);
      if (pagoEnvio === 'Sí') total += valorEnvio;
      if (pagoImpuestos === 'Sí') total += valorImpuestos;

      costoFinalUnidad = total / unidades;

      document.getElementById('resultadoCompras').innerHTML =
        `Costo final por unidad: ${formatoCOP(costoFinalUnidad)}`;
    }

    function comisionPorCategoria(categoria, tipo) {
      let comision = 0.13;
      if (tipo === 'clasica') comision = 0.08;
      const cat = categoria.toLowerCase();
      if (cat.includes('vehículo') || cat.includes('repuestos')) {
        comision = tipo === 'premium' ? 0.11 : 0.07;
      }
      if (cat.includes('inmueble') || cat.includes('servicio')) {
        comision = 0.0;
      }
      if (cat.includes('ropa') || cat.includes('zapatos')) {
        comision = tipo === 'premium' ? 0.16 : 0.13;
      }
      return comision;
    }

    function calcularVentas() {
      const usarCosto = document.getElementById('usarCosto').value;
      const categoria = document.getElementById('categoria').value;
      const tipo = document.getElementById('tipoPublicacion').value;
      const envioGratis = document.getElementById('envioGratis').value;
      const peso = parseFloat(document.getElementById('peso').value) || 1;
      const precioVentaManual = parseFloat(document.getElementById('precioVentaManual').value) || 0;

      const comision = comisionPorCategoria(categoria, tipo);

      let costoBase = usarCosto === 'Sí'
        ? (typeof costoFinalUnidad !== 'undefined' ? costoFinalUnidad : 0)
        : parseFloat(document.getElementById('costoBaseManual').value) || 0;

      let costoEnvio = 0;
      if (envioGratis === 'Sí') {
        costoEnvio = peso <= 1 ? 7000 : 12000;
      }

      const costoTotal = costoBase + costoEnvio;
      const precioSugerido = (costoTotal * 1.5) / (1 - comision);

      let texto = `Precio sugerido (50% rentabilidad): ${formatoCOP(precioSugerido)}`;
      const resultadoDiv = document.getElementById('resultadoVentas');

      if (precioVentaManual > 0) {
        const ingresoNeto = precioVentaManual * (1 - comision);
        const ganancia = ingresoNeto - costoTotal;
        const rentabilidad = (ganancia / costoTotal) * 100;
        const esGanancia = ganancia >= 0;
        texto += `\n\nSi vendes a ${formatoCOP(precioVentaManual)}:`;
        texto += `\n${esGanancia ? 'GANANCIA' : 'PÉRDIDA'}: ${formatoCOP(ganancia)} (${rentabilidad.toFixed(1)}% rentabilidad)`;
        texto += `\nGanancia neta por unidad: ${formatoCOP(ganancia)}`; // *** NUEVA LÍNEA ***
        resultadoDiv.innerHTML = texto.replace(/\n/g, "<br>");
        resultadoDiv.style.color = esGanancia ? "green" : "red";
      } else {
        resultadoDiv.innerHTML = texto;
        resultadoDiv.style.color = "black";
      }
    }
  </script>
</body>
</html>
