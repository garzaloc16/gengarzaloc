<div class="card max-w-2xl w-full mt-8">
  <h2 class="text-2xl font-bold mb-4 text-center">Cálculo de Ventas en MercadoLibre</h2>

  <label class="font-semibold">¿Usar costo calculado del formulario 1?</label>
  <select id="usarCosto" class="w-full border p-2 rounded mb-4">
    <option>Sí</option>
    <option>No</option>
  </select>

  <label class="font-semibold">Costo base manual (COP)</label>
  <input id="costoBaseManual" type="number" class="w-full border p-2 rounded mb-4" value="0">

  <label class="font-semibold">Categoría</label>
  <select id="categoria" class="w-full border p-2 rounded mb-4">
    <!-- Lista extensa de categorías -->
    <option>Celulares y Teléfonos</option>
    <option>Computación</option>
    <option>Consolas y Videojuegos</option>
    <option>Electrodomésticos</option>
    <option>Hogar y Muebles</option>
    <option>Accesorios para Vehículos</option>
    <option>Repuestos de Vehículos</option>
    <option>Herramientas</option>
    <option>Construcción</option>
    <option>Ropa, Zapatos y Accesorios</option>
    <option>Joyería y Relojes</option>
    <option>Belleza y Cuidado Personal</option>
    <option>Salud y Equipos Médicos</option>
    <option>Bebés</option>
    <option>Juguetes</option>
    <option>Deportes y Fitness</option>
    <option>Arte y Antigüedades</option>
    <option>Libros, Revistas y Comics</option>
    <option>Instrumentos Musicales</option>
    <option>Electrónica, Audio y Video</option>
    <option>Cámaras y Accesorios</option>
    <option>Inmuebles</option>
    <option>Servicios</option>
    <option>Otros</option>
  </select>

  <label class="font-semibold">Tipo de publicación</label>
  <select id="tipoPublicacion" class="w-full border p-2 rounded mb-4">
    <option value="premium">Premium</option>
    <option value="clasica">Clásica</option>
  </select>

  <label class="font-semibold">¿Ofrecer envío gratis?</label>
  <select id="envioGratis" class="w-full border p-2 rounded mb-4">
    <option>No</option>
    <option>Sí</option>
  </select>

  <label class="font-semibold">Peso del producto (kg)</label>
  <input id="peso" type="number" step="0.1" class="w-full border p-2 rounded mb-4" value="1">

  <hr class="my-4">

  <label class="font-semibold">¿Quieres poner tu precio de venta manual?</label>
  <input id="precioVentaManual" type="number" class="w-full border p-2 rounded mb-4" value="0">

  <button onclick="calcularVentas()" class="bg-blue-600 hover:bg-blue-700 text-white rounded p-2 w-full">
    Calcular
  </button>

  <div id="resultadoVentas" class="result mt-4 p-4 rounded bg-gray-100">
    Calcula el precio sugerido...
  </div>
</div>

<script>
function comisionPorCategoria(categoria, tipo) {
  // Valores base según documentación de Mercado Libre Colombia
  let comision = 0.13; // Premium
  if (tipo === 'clasica') comision = 0.08;

  // Ajustes para ciertas categorías
  const cat = categoria.toLowerCase();
  if (cat.includes('vehículo') || cat.includes('repuestos')) {
    comision = tipo === 'premium' ? 0.11 : 0.07; 
  }
  if (cat.includes('inmueble') || cat.includes('servicio')) {
    comision = 0.0; // estos no tienen comisión estándar
  }
  if (cat.includes('ropa') || cat.includes('zapatos')) {
    comision = tipo === 'premium' ? 0.16 : 0.13;
  }

  return comision;
}

function formatoCOP(valor) {
  return valor.toLocaleString('es-CO', {style:'currency', currency:'COP', minimumFractionDigits:0});
}

function calcularVentas() {
  const usarCosto = document.getElementById('usarCosto').value;
  const categoria = document.getElementById('categoria').value;
  const tipo = document.getElementById('tipoPublicacion').value;
  const envioGratis = document.getElementById('envioGratis').value;
  const peso = parseFloat(document.getElementById('peso').value) || 1;
  const precioVentaManual = parseFloat(document.getElementById('precioVentaManual').value) || 0;

  const comision = comisionPorCategoria(categoria, tipo);

  let costoBase = usarCosto === 'Sí'
    ? (typeof costoFinalUnidad !== 'undefined' ? costoFinalUnidad : 0)
    : parseFloat(document.getElementById('costoBaseManual').value) || 0;

  let costoEnvio = 0;
  if (envioGratis === 'Sí') {
    costoEnvio = peso <= 1 ? 7000 : 12000;
  }

  const costoTotal = costoBase + costoEnvio;

  // Precio sugerido con 50% de rentabilidad
  const precioSugerido = (costoTotal * 1.5) / (1 - comision);

  let texto = `Precio sugerido (50% rentabilidad): ${formatoCOP(precioSugerido)}`;

  if (precioVentaManual > 0) {
    const ingresoNeto = precioVentaManual * (1 - comision);
    const ganancia = ingresoNeto - costoTotal;
    const rentabilidad = (ganancia / costoTotal) * 100;
    const esGanancia = ganancia >= 0;

    texto += `\n\nSi vendes a ${formatoCOP(precioVentaManual)}:`;

    texto += `\n${esGanancia ? 'GANANCIA' : 'PÉRDIDA'}: ${formatoCOP(ganancia)} (${rentabilidad.toFixed(1)}% rentabilidad)`;

    const resultadoDiv = document.getElementById('resultadoVentas');
    resultadoDiv.innerHTML = texto.replace(/\n/g, "<br>");
    resultadoDiv.style.color = esGanancia ? "green" : "red";
  } else {
    const resultadoDiv = document.getElementById('resultadoVentas');
    resultadoDiv.innerHTML = texto;
    resultadoDiv.style.color = "black";
  }
}
</script>
